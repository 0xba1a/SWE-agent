source /root/tools/debug/lib/utils.sh

main() {
    if [ -z "$1" ]
    then
        echo "Usage: debug_start <binary>"
        return
    fi
    if [ ! -x "$1" ]
    then
        echo "Error: File $1 does not exist, or is not executable"
        return
    fi
    fp=$(realpath $1)
    _debug_command "SESSION=gdb"
    _debug_command "START"
    _debug_command "set confirm off"
    _debug_command "file $fp"
    if [ ! -z "$2" ]
    then
        _debug_command "set args ${@:2:$#}" # Set arguments from 2 until the end
    fi
    _debug_command "starti"
    _write_env INTERACTIVE_SESSION="gdb $@"
}

main "$@"
